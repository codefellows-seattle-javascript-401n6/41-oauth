<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Amber Kim: GitHub OAuth Exercise</title>
</head>

<body>
  <h1>Amber Kim GitHub Oauth Exercise</h1>

  <a id="authorize"></a>

  <section id="info"></section>

  <script type="application/javascript">
    'use strict';

    let a = document.getElementById('authorize');
    let AUTH_URL = 'https://github.com/login/oauth/authorize';
    let urlParams = {
      client_id: 'ae60072a03934f836244',
      redirect_uri: 'http://localhost:3000/oauth-callback',
      state: '' + Math.random()
    };
    let formattedURL = AUTH_URL + '?';
    for (let key in urlParams) {
      formattedURL += '&' + key + '=' + urlParams[key];
    }

    console.log('formatted url', formattedURL);

    a.setAttribute('href', formattedURL);
    a.textContent = 'Log in with GitHub';

    let infoSection = document.getElementById('info');

    let dCookie = document.cookie;
    console.log('document cookie', dCookie);
    if (!dCookie) {
      infoSection.textContent = 'You are not logged in';
    } else {
      let cookies = dCookie.split('; ');
      if (cookies[0] && cookies[1]) {
        let userInfo = cookies[1].split('=')[1];
        let firstName = userInfo.split('%20')[0];
        console.log('user info', userInfo);
        console.log(firstName);
        infoSection.textContent = `Welcome, ${firstName}!`;
      }
    }

    let clientId = 'ae60072a03934f836244';
    let reviewUrl = 'https://github.com/settings/connections/applications/' + clientId;
    // let reviewLink = document.getElementById('review');
    // reviewLink.setAttribute('href', reviewUrl);
    // reviewLink.textContent = 'Review Permissions';

  </script>
</body>

</html>